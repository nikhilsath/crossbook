{% macro render_editable_field(field, value, record_id, request, detail_endpoint, update_endpoint, id_param, field_type, table) %}
  <div class="mt-2">
    {% if request.args.get('edit') == field %}
      <form method="post" action="{{ url_for(update_endpoint, table=table, record_id=record_id) }}" class="inline">
        <input type="hidden" name="field" value="{{ field }}">
        <p class="text-xs text-gray-400">[DEBUG: {{ field }} → {{ field_type }}]</p>
        {% if field_type == "textarea" %}
          <textarea name="new_value" class="border px-1 py-0.5 text-sm rounded w-full">{{ value }}</textarea>

        {% elif field_type == "boolean" %}
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" name="new_value" value="1"
                 class="sr-only peer" {% if value in ("1", 1, True) %}checked{% endif %}>
          <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300
                      rounded-full peer peer-checked:bg-blue-600 transition duration-300"></div>
          <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full
                      transition-transform duration-300 transform peer-checked:translate-x-full"></div>
        </label>        

        {% elif field_type == "number" %}
          <input type="number" name="new_value" value="{{ value }}" class="border px-1 py-0.5 text-sm rounded">

        {% elif field_type == "date" %}
          <input type="date" name="new_value" value="{{ value }}" class="border px-1 py-0.5 text-sm rounded">

        {% else %}
          <input type="text" name="new_value" value="{{ value }}" class="border px-1 py-0.5 text-sm rounded">
        {% endif %}

        <button type="submit" class="text-blue-600 text-sm underline ml-1">Save</button>
        <a href="{{ url_for(detail_endpoint, table=table, record_id=record_id) }}" class="text-gray-500 ml-2 text-sm">Cancel</a>
      </form>

    {% else %}
    {% if field_type == "boolean" %}
    <input type="checkbox" disabled {% if value in ("1", 1, True) %}checked{% endif %}>
    {% elif field_type == "textarea" %}
      <pre class="ml-1 whitespace-pre-wrap">{{ value }}</pre>
    {% elif field_type == "select" or field_type == "multi_select" %}
      <span class="ml-1">{{ value }}</span>  {# Optional: format lists #}
    {% elif field_type == "date" %}
      <span class="ml-1">{{ value }}</span>  {# Could format ISO date if needed #}
    {% elif field_type == "foreign_key" %}
      <span class="ml-1 italic text-blue-600">{{ value }}</span>
    {% else %}
      <span class="ml-1">{{ value }}</span>
    {% endif %}
      <a href="{{ url_for(detail_endpoint, table=table, record_id=record_id) }}?edit={{ field }}" class="text-sm text-blue-600 underline ml-1">✏️</a>
    {% endif %}
  </div>
{% endmacro %}

{% macro render_edit_log(edit_log_text) %}
  {% if edit_log_text %}
    <details class="mt-6 text-sm text-gray-600">
      <summary class="cursor-pointer font-medium text-blue-600">Edit History</summary>
      <pre class="whitespace-pre-wrap mt-2">{{ edit_log_text }}</pre>
    </details>
  {% endif %}
{% endmacro %}

{% macro render_relationships(title, related_list, field_name, options, record_id, endpoint) %}
<div class="mb-4">
  <h3 class="font-semibold text-lg mb-2">{{ title }}</h3>

  <ul class="mb-2">
    {% for related in related_list %}
      <li class="flex justify-between items-center mb-1">
        <span>{{ related.name }}</span>
        <form method="POST" action="{{ endpoint }}/remove" class="inline">
          <input type="hidden" name="record_id" value="{{ record_id }}">
          <input type="hidden" name="related_id" value="{{ related.id }}">
          <input type="hidden" name="field_name" value="{{ field_name }}">
          <button class="text-red-500 hover:underline" type="submit">✕ Remove</button>
        </form>
      </li>
    {% else %}
      <li class="text-sm text-gray-500">No related records</li>
    {% endfor %}
  </ul>

  <form method="POST" action="{{ endpoint }}/add" class="flex gap-2 items-center">
    <input type="hidden" name="record_id" value="{{ record_id }}">
    <input type="hidden" name="field_name" value="{{ field_name }}">

    <select name="related_id" class="border rounded p-1 text-sm">
      {% for option in options %}
        <option value="{{ option.id }}">{{ option.name }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="text-green-600 hover:underline">+ Add</button>
  </form>
</div>
{% endmacro %}
